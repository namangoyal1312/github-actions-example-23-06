# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: project cicd flow

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    
    - uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

#     - name: ACR build
#       id: acr
#       uses: azure/acr-build@v1
#       with:
#         service_principal: ${{ secrets.service_principal }}
#         service_principal_password: ${{ secrets.service_principal_password }}
#         tenant: ${{ secrets.tenant }}
#         registry: ${{ secrets.registry }}
#         repository: ${{ secrets.repository }}
#         image: image
#         git_access_token: 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
#         folder: src/docker
#         dockerfile: ../../dockerfiles/Dockerfile
#         branch: main
#         build_args: '[{"arg_one":"value_one"}, {"arg_two":"value_two"}]'

    - name: Log in to ACR
      uses: azure/docker-login@v1
      with:
        login-server: acrloki.azurecr.io
        username: acrloki
        password: Siq/3W4+ntE9YfGNrbSpQFMHkOfm/YrdC9CheVOCmw+ACRALPmul

    - name: Build and push image
      uses: azure/docker@v1
      with:
        context: .
        Dockerfile: Dockerfile
        image: acrloki.azurecr.io/thanos:v1
        include-tags: latest
